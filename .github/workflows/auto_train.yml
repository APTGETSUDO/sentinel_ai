name: Sentinel Auto-Training

on:
  workflow_dispatch:        # Bouton manuel
  schedule:
    - cron: '0 0 * * 0'    # Dimanche minuit

jobs:
  train-model:
    runs-on: ubuntu-latest
    permissions:
      contents: write       # Vital pour sauvegarder le cerveau

    steps:
      # 1. R√©cup√©ration du code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Installation Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' 

      # 3. DIAGNOSTIC FICHIERS (Pour √™tre s√ªr)
      - name: üïµÔ∏è DEBUG - List Files
        run: |
          echo "üìÇ RACINE DU PROJET :"
          ls -R

      # 4. Installation des d√©pendances
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 5. ENTRA√éNEMENT (Avec s√©curit√© anti-erreur)
      - name: Run Training Script
        run: |
          export CUDA_VISIBLE_DEVICES=-1
          # On essaie de lancer le script. S'il n'est pas trouv√©, on affiche une erreur claire.
          if [ -f "train_bot.py" ]; then
            python train_bot.py
          else
            echo "‚ùå ERREUR CRITIQUE : Le fichier 'train_bot.py' est introuvable √† la racine."
            exit 1
          fi

      # 6. Sauvegarde du nouveau cerveau
      - name: Commit and Push new Model
        run: |
          git config --global user.name "SentinelBot"
          git config --global user.email "bot@sentinel.ai"
          git add sentinel_v1.keras
          # On commit seulement si le fichier a chang√©
          git commit -m "üß† Auto-Update: Cerveau r√©-entra√Æn√©" || echo "Pas de changement d√©tect√©"
          git push
